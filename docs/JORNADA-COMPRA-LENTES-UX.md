# ğŸ¯ Jornada de Compra de Lentes - UX Otimizada

## ğŸ§­ VisÃ£o Geral

A jornada ideal deve equilibrar **simplicidade para o vendedor** com **decisÃ£o informada para o negÃ³cio**. O objetivo Ã© encontrar a melhor lente pelo melhor custo-benefÃ­cio em poucos cliques.

---

## ğŸ“Š Fluxo Proposto (4 Etapas)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ETAPA 1: RECEITA DO CLIENTE                 â”‚
â”‚  "Qual a necessidade do cliente?"                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Radio] Tipo de Lente:                                         â”‚
â”‚    â—‹ VisÃ£o Simples (miopia/hipermetropia)                       â”‚
â”‚    â—‹ Multifocal (presbiopia - ver longe e perto)               â”‚
â”‚    â—‹ Bifocal (duas Ã¡reas de visÃ£o)                             â”‚
â”‚                                                                  â”‚
â”‚  [Input] Grau EsfÃ©rico: [-8.00 a +6.00]                        â”‚
â”‚  [Input] Grau CilÃ­ndrico: [-4.00 a 0.00] (se tiver)           â”‚
â”‚  [Input] AdiÃ§Ã£o: [+0.50 a +4.00] (sÃ³ para multifocal)         â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’¡ Sistema jÃ¡ filtra lentes compatÃ­veis com essa receita       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ETAPA 2: CATEGORIA E QUALIDADE DESEJADA            â”‚
â”‚  "Qual a expectativa de qualidade/preÃ§o do cliente?"            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Cards Grandes com Preview]                                    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ğŸ’° STANDARD â”‚  â”‚ â­ PREMIUM   â”‚  â”‚ ğŸ‘‘ SUPER     â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   PREMIUM    â”‚         â”‚
â”‚  â”‚ Lentes       â”‚  â”‚ Marcas       â”‚  â”‚ Top de linha â”‚         â”‚
â”‚  â”‚ genÃ©ricas    â”‚  â”‚ conhecidas   â”‚  â”‚ Tecnologia   â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ exclusiva    â”‚         â”‚
â”‚  â”‚ R$ 250-500   â”‚  â”‚ R$ 800-2000  â”‚  â”‚ R$ 3000-9000 â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚         â”‚
â”‚  â”‚ 187 opÃ§Ãµes   â”‚  â”‚ 250 opÃ§Ãµes   â”‚  â”‚ 60 opÃ§Ãµes    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’¡ Cada categoria jÃ¡ vem filtrada pela receita da etapa 1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ETAPA 3: ESPECIFICAÃ‡Ã•ES TÃ‰CNICAS (CanÃ´nicas)            â”‚
â”‚  "Qual material/tratamento combina melhor?"                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” [Input Busca] "policarbonato", "blue light", etc           â”‚
â”‚                                                                  â”‚
â”‚  [Filtros RÃ¡pidos - Chips]                                      â”‚
â”‚  [CR39] [Policarbonato] [Trivex] [High Index]                  â”‚
â”‚  [AR] [Blue Light] [FotossensÃ­vel] [Polarizado]                â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Resultados (Grid de Cards):                                    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ“ POLICARBONATO 1.59 VisÃ£o Simples +AR +UV                 â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ğŸ“Š Material: POLICARBONATO  |  Ãndice: 1.59                â”‚â”‚
â”‚  â”‚ ğŸ”¬ Tratamentos: AR â€¢ UV â€¢ Antirrisco                        â”‚â”‚
â”‚  â”‚ ğŸ‘ï¸  EsfÃ©rico: -10 a +6  |  CilÃ­ndrico: 0 a -2            â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ğŸ’° Faixa de PreÃ§o: R$ 281 - R$ 320                         â”‚â”‚
â”‚  â”‚ ğŸ­ 3 laboratÃ³rios disponÃ­veis                               â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ [Comparar Fornecedores â†’]                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’¡ Ordenar por: [PreÃ§o â†“] [Qualidade] [Prazo] [Popularidade] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ETAPA 4: COMPARAÃ‡ÃƒO DE FORNECEDORES (DecisÃ£o Final)       â”‚
â”‚  "Qual laboratÃ³rio oferece o melhor custo-benefÃ­cio?"           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Grupo Selecionado: POLICARBONATO 1.59 VisÃ£o Simples +AR +UV   â”‚
â”‚                                                                  â”‚
â”‚  [Tabela Comparativa Interativa]                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Lab      â”‚ Marca   â”‚ PreÃ§o  â”‚ Prazo   â”‚ Quali.   â”‚ AÃ§Ã£o   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â­ HOYA  â”‚ HiVisionâ”‚ R$ 281 â”‚ 5 dias  â”‚ â˜…â˜…â˜…â˜…â˜…   â”‚ Escolh.â”‚ â”‚
â”‚  â”‚ Destaque â”‚ Ultra   â”‚  ğŸ‘    â”‚  âš¡     â”‚ Premium  â”‚   er   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Essilor  â”‚ Crizal  â”‚ R$ 295 â”‚ 3 dias  â”‚ â˜…â˜…â˜…â˜…â˜…   â”‚ Escolh.â”‚ â”‚
â”‚  â”‚          â”‚ Easy    â”‚        â”‚  âš¡âš¡   â”‚ Premium  â”‚   er   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ GenÃ©rico â”‚ Standardâ”‚ R$ 250 â”‚ 7 dias  â”‚ â˜…â˜…â˜…â˜†â˜†   â”‚ Escolh.â”‚ â”‚
â”‚  â”‚          â”‚         â”‚  ğŸ’°    â”‚         â”‚ BÃ¡sico   â”‚   er   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  [Filtros de DecisÃ£o]                                           â”‚
â”‚  â˜‘ï¸ Mostrar apenas com estoque  â˜ SÃ³ laboratÃ³rios parceiros    â”‚
â”‚                                                                  â”‚
â”‚  [Ordenar por]: â—‹ Menor PreÃ§o  â— Melhor Prazo  â—‹ Qualidade     â”‚
â”‚                                                                  â”‚
â”‚  â„¹ï¸ Dica: HOYA oferece melhor custo-benefÃ­cio (prazo + quali)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CONFIRMAÃ‡ÃƒO E DADOS DO PEDIDO                      â”‚
â”‚  (Etapa atual do wizard - mantÃ©m como estÃ¡)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Detalhamento por Etapa

### **ETAPA 1: Receita do Cliente**

#### ğŸ¯ Objetivo

Capturar dados clÃ­nicos bÃ¡sicos para **filtrar automaticamente** apenas lentes compatÃ­veis.

#### ğŸ“‹ Campos

```typescript
interface ReceitaCliente {
  tipo_lente: "visao_simples" | "multifocal" | "bifocal";

  // Graus
  esferico_od: number; // Olho Direito
  cilindrico_od: number | null;
  adicao_od: number | null; // SÃ³ para multifocal

  esferico_oe: number; // Olho Esquerdo
  cilindrico_oe: number | null;
  adicao_oe: number | null;
}
```

#### ğŸ” LÃ³gica de Filtro

```typescript
// Query automÃ¡tica que filtra canÃ´nicas compatÃ­veis
const { data: lentesCompativeis } = await lentesClient
  .from("v_grupos_canonicos")
  .select("*")
  .eq("tipo_lente", receita.tipo_lente)
  .lte("esferico_min", receita.esferico_od) // CanÃ´nica cobre o grau
  .gte("esferico_max", receita.esferico_od)
  .lte("cilindrico_min", receita.cilindrico_od || 0)
  .gte("cilindrico_max", receita.cilindrico_od || 0)
  // Se multifocal, verifica adiÃ§Ã£o tambÃ©m
  .gte("adicao_max", receita.adicao_od || 0);
```

#### ğŸ’¡ UX Highlights

- âœ… ValidaÃ§Ã£o em tempo real (graus vÃ¡lidos)
- âœ… Auto-disable de campos irrelevantes (adiÃ§Ã£o sÃ³ aparece em multifocal)
- âœ… Tooltip explicativo em cada campo
- âœ… BotÃ£o "NÃ£o sei o grau" â†’ modo simplificado

---

### **ETAPA 2: Categoria/Segmento**

#### ğŸ¯ Objetivo

Direcionar para **Standard ou Premium** baseado no perfil de compra do cliente.

#### ğŸ¨ Design (Cards Grandes)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° LENTES STANDARD                â”‚
â”‚                                     â”‚
â”‚  âœ“ Lentes genÃ©ricas de qualidade   â”‚
â”‚  âœ“ Ã“timo custo-benefÃ­cio            â”‚
â”‚  âœ“ Atende 90% dos casos             â”‚
â”‚                                     â”‚
â”‚  Faixa: R$ 250 - R$ 500            â”‚
â”‚  187 grupos disponÃ­veis             â”‚
â”‚                                     â”‚
â”‚  [Explorar Standard â†’]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â­ LENTES PREMIUM                 â”‚
â”‚                                     â”‚
â”‚  âœ“ Marcas renomadas (Hoya, Essilor)â”‚
â”‚  âœ“ Tecnologias avanÃ§adas            â”‚
â”‚  âœ“ Garantias estendidas             â”‚
â”‚                                     â”‚
â”‚  Faixa: R$ 800 - R$ 9.000         â”‚
â”‚  250 grupos disponÃ­veis             â”‚
â”‚                                     â”‚
â”‚  [Explorar Premium â†’]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”€ DecisÃ£o EstratÃ©gica

**Por que separar Standard Ã— Premium?**

1. **Simplifica escolha**: Cliente jÃ¡ sabe se quer "bÃ¡sico" ou "top de linha"
2. **Reduz sobrecarga cognitiva**: NÃ£o mistura R$ 300 com R$ 3.000 na mesma lista
3. **Melhora conversÃ£o**: Foco no que faz sentido para cada perfil
4. **Facilita upsell**: Vendedor pode mostrar "veja a diferenÃ§a de Premium"

---

### **ETAPA 3: EspecificaÃ§Ãµes TÃ©cnicas (Grupo CanÃ´nico)**

#### ğŸ¯ Objetivo

Refinar escolha por **material, tratamentos e tecnologias**.

#### ğŸ¨ Filtros Inteligentes (Chips clicÃ¡veis)

```tsx
<div className="flex flex-wrap gap-2 mb-6">
  {/* Materiais */}
  <FilterChip
    active={filtro.material === "POLICARBONATO"}
    onClick={() => setFiltro({ material: "POLICARBONATO" })}
    icon="ğŸ›¡ï¸"
  >
    Policarbonato (resistente)
  </FilterChip>

  <FilterChip active={filtro.material === "CR39"} icon="ğŸ’">
    CR39 (leve e econÃ´mico)
  </FilterChip>

  <FilterChip active={filtro.material === "HIGH_INDEX"} icon="âœ¨">
    High Index (finas)
  </FilterChip>

  {/* Tratamentos */}
  <FilterChip active={filtro.blue_light} icon="ğŸ”µ">
    Blue Light (telas)
  </FilterChip>

  <FilterChip active={filtro.fotossensivel} icon="â˜€ï¸">
    FotossensÃ­vel (escurece no sol)
  </FilterChip>

  <FilterChip active={filtro.ar} icon="âœ¨">
    Antirreflexo
  </FilterChip>
</div>
```

#### ğŸ“Š Cards de Resultado (Design Proposto)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ POLICARBONATO 1.59 VisÃ£o Simples +AR +UV +Blue          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ“Š EspecificaÃ§Ãµes                                          â”‚
â”‚  â”œâ”€ Material: POLICARBONATO (resistente a impactos)        â”‚
â”‚  â”œâ”€ Ãndice: 1.59 (espessura mÃ©dia)                         â”‚
â”‚  â””â”€ Categoria: Standard                                     â”‚
â”‚                                                              â”‚
â”‚  ğŸ”¬ Tratamentos Inclusos                                    â”‚
â”‚  â”œâ”€ âœ¨ Antirreflexo (AR)                                   â”‚
â”‚  â”œâ”€ ğŸ”µ Blue Light (proteÃ§Ã£o digital)                       â”‚
â”‚  â”œâ”€ â˜€ï¸ UV400 (proteÃ§Ã£o solar)                             â”‚
â”‚  â””â”€ ğŸ›¡ï¸ Antirrisco                                         â”‚
â”‚                                                              â”‚
â”‚  ğŸ‘ï¸ Compatibilidade com sua receita                        â”‚
â”‚  â”œâ”€ EsfÃ©rico: -10.00 a +6.00 âœ“                            â”‚
â”‚  â”œâ”€ CilÃ­ndrico: 0.00 a -2.00 âœ“                            â”‚
â”‚  â””â”€ AdiÃ§Ã£o: N/A (visÃ£o simples)                           â”‚
â”‚                                                              â”‚
â”‚  ğŸ’° Economia Estimada                                       â”‚
â”‚  â”œâ”€ PreÃ§o MÃ­nimo: R$ 281,29                               â”‚
â”‚  â”œâ”€ PreÃ§o MÃ©dio: R$ 302,45                                â”‚
â”‚  â””â”€ PreÃ§o MÃ¡ximo: R$ 320,00                               â”‚
â”‚                                                              â”‚
â”‚  ğŸ­ Disponibilidade                                         â”‚
â”‚  â””â”€ 3 laboratÃ³rios oferecem este grupo                     â”‚
â”‚                                                              â”‚
â”‚  [ğŸ“‹ Comparar LaboratÃ³rios] [â¤ï¸ Favoritar]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ¯ OrdenaÃ§Ã£o Inteligente

```tsx
<Select value={ordenacao} onChange={setOrdenacao}>
  <option value="preco_asc">ğŸ’° Menor PreÃ§o (economizar)</option>
  <option value="preco_desc">ğŸ‘‘ Maior PreÃ§o (top de linha)</option>
  <option value="qualidade">â­ Melhor AvaliaÃ§Ã£o</option>
  <option value="prazo">âš¡ Entrega Mais RÃ¡pida</option>
  <option value="popularidade">ğŸ”¥ Mais Vendidas</option>
  <option value="disponibilidade">ğŸ“¦ Mais OpÃ§Ãµes de Lab</option>
</Select>
```

---

### **ETAPA 4: ComparaÃ§Ã£o de Fornecedores** (ğŸŒŸ ETAPA CRÃTICA)

#### ğŸ¯ Objetivo

Decidir **qual laboratÃ³rio** fornecerÃ¡ a lente escolhida, comparando:

- ğŸ’° PreÃ§o
- âš¡ Prazo de entrega
- â­ Qualidade/ReputaÃ§Ã£o
- ğŸ“¦ Disponibilidade

#### ğŸ¨ Layout: Tabela Comparativa

```
Grupo: POLICARBONATO 1.59 VisÃ£o Simples +AR +UV

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LaboratÃ³rio  â”‚ Linha      â”‚ PreÃ§o   â”‚ Prazo    â”‚ Quali.   â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â­ HOYA      â”‚ HiVision   â”‚ R$ 281  â”‚ 5 dias   â”‚ â˜…â˜…â˜…â˜…â˜…   â”‚ [Escolh] â”‚
â”‚              â”‚ Ultra      â”‚  ğŸ†     â”‚  âš¡      â”‚          â”‚          â”‚
â”‚              â”‚            â”‚         â”‚          â”‚  ğŸ’¼ CNPJ â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Essilor      â”‚ Crizal     â”‚ R$ 295  â”‚ 3 dias   â”‚ â˜…â˜…â˜…â˜…â˜…   â”‚ [Escolh] â”‚
â”‚              â”‚ Easy       â”‚         â”‚  âš¡âš¡    â”‚          â”‚          â”‚
â”‚              â”‚            â”‚         â”‚          â”‚  ğŸ’¼ CNPJ â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Vision Opt   â”‚ Standard   â”‚ R$ 250  â”‚ 7 dias   â”‚ â˜…â˜…â˜…â˜†â˜†   â”‚ [Escolh] â”‚
â”‚              â”‚            â”‚  ğŸ’°ğŸ’°  â”‚          â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š EstatÃ­sticas dos 3 fornecedores:                                   â”‚
â”‚ â€¢ VariaÃ§Ã£o de preÃ§o: R$ 45 (18%)                                      â”‚
â”‚ â€¢ Prazo mÃ©dio: 5 dias                                                 â”‚
â”‚ â€¢ Melhor custo-benefÃ­cio: HOYA (prazo + qualidade + preÃ§o razoÃ¡vel)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Filtros RÃ¡pidos]
â˜‘ï¸ Apenas com estoque    â˜ SÃ³ parceiros preferenciais    â˜ Entrega < 5 dias

[Ordenar por]
â—‹ Menor PreÃ§o    â— Melhor Prazo    â—‹ Maior Qualidade    â—‹ Recomendado
```

#### ğŸ” Query para Fornecedores

```typescript
const { data: fornecedores } = await lentesClient
  .from("v_fornecedores_por_lente")
  .select(
    `
    lente_id,
    fornecedor_nome,
    marca_nome,
    linha_produto,
    preco_tabela,
    prazo_entrega,
    disponivel,
    destaque,
    novidade,
    // Campos extras para decisÃ£o
    lente_nome,
    beneficios,
    observacoes
  `
  )
  .eq("grupo_id", grupoSelecionado.grupo_id)
  .eq("disponivel", true)
  .order("preco_tabela", { ascending: true }) // Ordena por padrÃ£o
  .limit(10); // MÃ¡ximo 10 fornecedores
```

#### ğŸ’¡ Indicadores de DecisÃ£o

```tsx
{
  fornecedores.map((f) => (
    <tr key={f.lente_id} className="hover:bg-blue-50 cursor-pointer">
      <td>
        <div className="flex items-center gap-2">
          {f.destaque && <Badge variant="warning">â­ Destaque</Badge>}
          {f.novidade && <Badge variant="info">ğŸ†• Novo</Badge>}
          <strong>{f.fornecedor_nome}</strong>
        </div>
      </td>

      <td className="text-2xl font-bold text-green-600">
        R$ {f.preco_tabela.toFixed(2)}
        {f.preco_tabela === precoMinimo && (
          <Badge className="ml-2" variant="success">
            ğŸ’° Melhor preÃ§o
          </Badge>
        )}
      </td>

      <td>
        {f.prazo_entrega || 5} dias Ãºteis
        {f.prazo_entrega <= 3 && <Badge variant="info">âš¡ RÃ¡pido</Badge>}
      </td>

      <td>
        <StarRating value={calcularQualidade(f)} />
        {isParceiroPremium(f.fornecedor_nome) && (
          <Badge variant="premium">ğŸ’¼ Parceiro</Badge>
        )}
      </td>

      <td>
        <Button
          onClick={() => selecionarFornecedor(f)}
          variant={fornecedorEscolhido === f.lente_id ? "primary" : "outline"}
        >
          {fornecedorEscolhido === f.lente_id ? "âœ“ Escolhido" : "Escolher"}
        </Button>
      </td>
    </tr>
  ));
}
```

#### ğŸ¯ RecomendaÃ§Ã£o AutomÃ¡tica (IA/HeurÃ­stica)

```typescript
function calcularMelhorCustoBeneficio(fornecedores: Fornecedor[]) {
  return fornecedores
    .map(f => ({
      ...f,
      score: (
        // Peso: 40% preÃ§o, 30% prazo, 30% qualidade
        (1 - (f.preco_tabela / maxPreco)) * 0.4 +
        (1 - (f.prazo_entrega / maxPrazo)) * 0.3 +
        (f.qualidade_rating / 5) * 0.3
      )
    }))
    .sort((a, b) => b.score - a.score)[0]
}

// Exibir sugestÃ£o
const recomendado = calcularMelhorCustoBeneficio(fornecedores)
<Alert variant="info" className="mt-4">
  ğŸ’¡ <strong>RecomendaÃ§Ã£o:</strong> {recomendado.fornecedor_nome} oferece o
  melhor custo-benefÃ­cio (score: {(recomendado.score * 100).toFixed(0)}/100)
</Alert>
```

---

## ğŸ¯ ImplementaÃ§Ã£o PrÃ¡tica no Wizard

### Estrutura de State Atualizada

```typescript
interface WizardState {
  step: 1 | 2 | 3 | 4 | 5; // 5 steps agora

  // Step 1: Receita
  receita: {
    tipo_lente: string;
    esferico_od: number;
    cilindrico_od: number | null;
    adicao_od: number | null;
  };

  // Step 2: Categoria
  categoria: "standard" | "premium";

  // Step 3: Grupo CanÃ´nico
  grupoSelecionado: GrupoCanonicoView | null;
  filtrosGrupo: {
    material: string;
    tratamentos: string[];
    busca: string;
  };

  // Step 4: Fornecedor
  fornecedorSelecionado: FornecedorLente | null;
  ordenacaoFornecedores: "preco" | "prazo" | "qualidade";

  // Step 5: Dados do Cliente (mantÃ©m como estÃ¡)
  cliente: DadosCliente;
}
```

### Componentes Sugeridos

```
src/components/forms/CriarPedidoWizard/
â”œâ”€â”€ Step1Receita.tsx              # Captura graus
â”œâ”€â”€ Step2Categoria.tsx            # Standard vs Premium
â”œâ”€â”€ Step3GruposCanonicoses.tsx     # Busca e filtros
â”œâ”€â”€ Step4Fornecedores.tsx         # Tabela comparativa â­
â”œâ”€â”€ Step5DadosCliente.tsx         # Form atual
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ReceitaForm.tsx
â”‚   â”œâ”€â”€ CategoriaCard.tsx
â”‚   â”œâ”€â”€ GrupoCanonicoCard.tsx
â”‚   â”œâ”€â”€ TabelaFornecedores.tsx    # Componente crÃ­tico
â”‚   â”œâ”€â”€ FilterChip.tsx
â”‚   â””â”€â”€ RecomendacaoIA.tsx
â””â”€â”€ utils/
    â”œâ”€â”€ calcularCompatibilidade.ts
    â””â”€â”€ rankearFornecedores.ts
```

---

## ğŸš€ Melhorias de Usabilidade

### 1. **Breadcrumbs com EdiÃ§Ã£o**

```
[Receita: -2.00 esf, -0.75 cil âœï¸] â†’
[Categoria: Standard âœï¸] â†’
[Lente: Policarbonato 1.59 âœï¸] â†’
[Fornecedor: ...] â†’
[Cliente]
```

Permite voltar e editar qualquer etapa sem perder o progresso.

### 2. **ComparaÃ§Ã£o Side-by-Side (Modal)**

```tsx
<Button onClick={() => setShowComparison(true)}>
  Comparar 3 Selecionados
</Button>

<ComparisonModal>
  <table>
    <thead>
      <tr>
        <th>CritÃ©rio</th>
        <th>HOYA</th>
        <th>Essilor</th>
        <th>Vision</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>PreÃ§o</td>
        <td className="text-green-600">R$ 281</td>
        <td>R$ 295</td>
        <td className="font-bold">R$ 250 ğŸ†</td>
      </tr>
      <tr>
        <td>Prazo</td>
        <td>5 dias</td>
        <td className="text-green-600">3 dias ğŸ†</td>
        <td>7 dias</td>
      </tr>
      {/* ... */}
    </tbody>
  </table>
</ComparisonModal>
```

### 3. **Favoritos/HistÃ³rico**

```tsx
// Salvar grupos favoritos do vendedor
const favoritos = useFavoritos()

<Button
  variant="ghost"
  onClick={() => favoritos.toggle(grupo.grupo_id)}
>
  {favoritos.has(grupo.grupo_id) ? 'â¤ï¸' : 'ğŸ¤'} Favoritar
</Button>

// Mostrar "Ãšltimas 5 escolhas" no topo
<section className="mb-6">
  <h3>âš¡ Suas Ãºltimas escolhas</h3>
  <div className="flex gap-2">
    {historico.map(g => (
      <Chip onClick={() => selecionarRapido(g)}>
        {g.nome_grupo}
      </Chip>
    ))}
  </div>
</section>
```

### 4. **Modo Especialista vs Simplificado**

```tsx
<Toggle>
  <ToggleOption value="simples">
    ğŸš€ Modo RÃ¡pido (recomendaÃ§Ãµes automÃ¡ticas)
  </ToggleOption>
  <ToggleOption value="avancado">
    ğŸ”§ Modo AvanÃ§ado (todos os filtros)
  </ToggleOption>
</Toggle>

// Modo RÃ¡pido: Pula step 2 e 3, vai direto para o melhor custo-benefÃ­cio
// Modo AvanÃ§ado: Mostra todas as 5 etapas
```

---

## ğŸ“Š MÃ©tricas de Sucesso

### KPIs para Medir EficiÃªncia da Jornada

```typescript
interface MetricasJornada {
  // Tempo
  tempo_medio_compra: number; // Meta: < 2 minutos
  taxa_abandono_por_step: {
    step1: number; // Meta: < 5%
    step2: number; // Meta: < 10%
    step3: number; // Meta: < 15%
    step4: number; // Meta: < 20%
  };

  // DecisÃ£o
  taxa_uso_filtros: number; // % que usa filtros avanÃ§ados
  taxa_comparacao: number; // % que compara fornecedores
  taxa_aceite_recomendacao: number; // % que escolhe a sugestÃ£o

  // NegÃ³cio
  ticket_medio_por_categoria: {
    standard: number;
    premium: number;
  };
  taxa_upsell_premium: number; // % que comeÃ§a standard e vai pra premium
}
```

---

## âœ… Checklist de ImplementaÃ§Ã£o

### Fase 1: FundaÃ§Ã£o (Esta Sprint)

- [x] Corrigir query de busca (`nome_grupo`)
- [ ] Criar Step1Receita (captura graus)
- [ ] Criar Step2Categoria (Standard vs Premium)
- [ ] Atualizar Step3 com filtros (usar GrupoCanonicoCard)
- [ ] Criar Step4Fornecedores (TabelaComparativa)
- [ ] Manter Step5 (dados cliente - jÃ¡ existe)

### Fase 2: UX AvanÃ§ado (PrÃ³xima Sprint)

- [ ] Breadcrumbs editÃ¡veis
- [ ] Sistema de favoritos
- [ ] HistÃ³rico de Ãºltimas escolhas
- [ ] ComparaÃ§Ã£o side-by-side (modal)
- [ ] RecomendaÃ§Ã£o automÃ¡tica (heurÃ­stica)

### Fase 3: OtimizaÃ§Ãµes (Futuro)

- [ ] Analytics de abandono por step
- [ ] A/B test: 4 steps vs 5 steps
- [ ] Busca inteligente por voz (opcional)
- [ ] IntegraÃ§Ã£o com sistema de precificaÃ§Ã£o dinÃ¢mica

---

## ğŸ¯ Resumo Executivo

### Por que 5 Steps Ã© melhor que 3?

| Aspecto    | 3 Steps (Atual)     | 5 Steps (Proposto)                       | Vantagem        |
| ---------- | ------------------- | ---------------------------------------- | --------------- |
| Contexto   | Busca genÃ©rica      | Receita â†’ Categoria â†’ Grupo â†’ Fornecedor | +Direcionamento |
| Escolha    | Tudo misturado      | Filtro progressivo                       | -Sobrecarga     |
| ComparaÃ§Ã£o | NÃ£o existe          | Tabela side-by-side                      | +TransparÃªncia  |
| ConversÃ£o  | Incerta             | Alta (decisÃ£o informada)                 | +Vendas         |
| Tempo      | ~3min (muita busca) | ~2min (guiado)                           | +EficiÃªncia     |

### Resposta Direta ao seu Questionamento

**"Como seria isso e qual a melhor forma de usabilidade?"**

âœ… **Melhor jornada**:

1. Receita (filtro inteligente)
2. Categoria (segmentaÃ§Ã£o clara)
3. Grupo CanÃ´nico (specs tÃ©cnicas)
4. Fornecedor (comparaÃ§Ã£o transparente)
5. Cliente (dados finais)

âœ… **Melhor usabilidade**:

- Filtros progressivos (nÃ£o tudo de uma vez)
- ComparaÃ§Ã£o visual (tabela, nÃ£o lista)
- RecomendaÃ§Ã£o automÃ¡tica (IA ajuda a decidir)
- Breadcrumbs editÃ¡veis (voltar sem perder contexto)
- Modo rÃ¡pido vs avanÃ§ado (flexibilidade)

ğŸ¯ **Resultado**: DecisÃ£o rÃ¡pida, informada e confiante em ~2 minutos.
